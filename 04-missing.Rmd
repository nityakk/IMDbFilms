# Missing values

```{r}
library(tidyverse)
library(patchwork)
library(reshape2)
```



```{r}
# Load data
# names <- read.table(file = 'sources/names.tsv', sep = '\t', header = TRUE, fill = TRUE)
# names[names == "\\N"] <- NA
```


```{r}
# cp = 0 for counts, 1 for percents
missing_plots <- function(data, percent = FALSE) {
  
  # Get missing patterns
  missing_patterns <- data.frame(is.na(data)) %>%
    group_by_all() %>%
    count(name = "count", sort = TRUE) %>%
    ungroup()
  
 # missing_patterns
  new_missing_patterns <- as.matrix(
    missing_patterns[1:(length(missing_patterns)-1)])
  melted <- melt(new_missing_patterns)
  a <- apply(missing_patterns[1:(length(missing_patterns)-1)], 
             1, function(y)length(y[y == TRUE]))
  a_x <- which(a == 0)
  
  # missing_patterns2
  missing_patterns2 <- missing_patterns[1:(length(missing_patterns)-1)]
  
  missing_patterns2 <- missing_patterns2 %>% 
      rownames_to_column("id") %>% 
      gather(key, value, -id) %>% 
      mutate(missing = ifelse(value == 1, "yes", "no"))
  
  missing_patterns2 <- missing_patterns2 %>% 
    mutate(missing2 = ifelse(missing == "yes", 2, 1))
  
  missing_patterns3 <- missing_patterns2 %>% 
      mutate(missing2 = ifelse(id == a_x, 0, missing2))

  #Plot Upper Side
  freq <- c()
  value <- unique(melted$Var2)
  
  if (length(apply(new_missing_patterns, 2, function(y) which(y == TRUE))) == 0){
    freq <- rep(0, length(value))
  } else {
    for (i in apply(new_missing_patterns, 2, function(y) which(y == TRUE))){
      sum <- 0
      for (j in i){
        sum <- sum + missing_patterns$count[j]
        
      }
      freq <- c(freq, sum)
    }
  }
  
  if (percent) {
    total = sum(missing_patterns$count)
    freq <- (freq/total)*100
    
    demo <- data.frame(value, freq)
    col <- ggplot(demo, aes(x = reorder(value, -freq), freq)) +
      geom_bar(stat = 'identity', fill = "blue", alpha = 0.6) +
      scale_x_discrete(label=function(x) abbreviate(x, minlength = 5)) +
      ylim(0, 100) +
      xlab("") +
      ylab("% rows missing:") +
      theme(panel.border = element_rect(color = "black", fill = NA, size = 0.5))
    
  } else {
    demo <- data.frame(value, freq)
    col <- ggplot(demo, aes(x = reorder(value, -freq), freq)) +
      geom_bar(stat = 'identity', fill = "blue", alpha = 0.6) +
      scale_x_discrete(label=function(x) abbreviate(x, minlength = 5)) +
      xlab("") +
      ylab("num rows missing:") +
      theme(panel.border = element_rect(color = "black", fill = NA, size = 0.5))
  } 
  
  temp_x <- length(unique(missing_patterns3$key)) / 2 + 0.5
  temp_y <- nrow(missing_patterns) - a_x + 1
  
  temp_f = levels((reorder(value, -freq)))
  missing_patterns3$key <- fct_relevel(missing_patterns3$key, temp_f)

  # main plot
  main <- ggplot(missing_patterns3, aes(x = key, y = fct_rev(fct_reorder(id,as.integer(id))), fill = as.factor(missing2))) +
    geom_tile(color="white", alpha = 0.8) +
    scale_x_discrete(label=function(x) abbreviate(x, minlength = 5)) +
    scale_fill_manual(values=c("gray60","gray80","mediumpurple1")) +
    xlab("variable") +
    ylab("missing pattern") +
    annotate("text",x = temp_x, y = temp_y, label= "complete cases", fontface = 1, color="black") +
    theme(legend.position="none", axis.line = element_line(colour = "black"))

  # Plot Right Side
  A_x <- length(unique((melted$Var1)))
  area.color <- replicate(A_x, "blue")
  area.color[a_x] <- "darkblue"
  
  if (percent) {
    total = sum(missing_patterns$count)
    rowy <- (missing_patterns$count/total)*100
    
    row <- ggplot(missing_patterns, aes(x = unique(melted$Var1), y = rowy)) +
      geom_bar(stat = "identity", fill = area.color, alpha = 0.5) +
      coord_flip() +
      scale_x_reverse(breaks = seq(0,A_x,1)) +
      ylim(0, 100) +
      xlab("") +
      ylab("% rows") +
      theme(panel.border = element_rect(color = "black", fill = NA, size = 0.5))
  } else {
    row <- ggplot(missing_patterns, aes(x = unique(melted$Var1), y = count)) +
      geom_bar(stat = "identity", fill = area.color, alpha = 0.5) +
      coord_flip() +
      scale_x_reverse(breaks = seq(0,A_x,1)) +
      xlab("") +
      ylab("row count") +
      theme(panel.border = element_rect(color = "black", fill = NA, size = 0.5))
  }

  final_plot <- col + plot_spacer() + main + row + plot_layout(ncol = 2,widths = c(5, 1),heights = c(1, 3))
  final_plot
}
```

```{r}

missing_plots(names, percent = TRUE)
missing_plots(basics, percent = TRUE)
missing_plots(crew, percent = TRUE)
missing_plots(ratings, percent = TRUE)
```

<br/><br/> 
We have plotted the graphs that denotes the missing values in the 'name' dataset that we have used. The 'name' dataset includes the following information:<br/>
1.nconst (string) - alphanumeric unique identifier of the name/person.<br/>
2.primaryName (string)– name by which the person is most often credited.<br/>
3.birthYear – in YYYY format.<br/>
4.deathYear – in YYYY format if applicable.<br/>
5.primaryProfession (array of strings)– the top-3 professions of the person.<br/>
6.knownForTitles (array of tconsts) – titles the person is known for.<br/>

The first graph above shows the missing values counts whereas the second graph denotes the missing values by percentage.<br/>
Analysis:<br/>
1. It is observed from the graphs above that the dataset has no missing values for the columns that denotes the person's detail such as the unique number used to identify them, the person's name and the person's profession. Thus, there is no inconsistency in the data that reveals information about the celebrities.<br/>
2. The variable that is missing at maximum instances is the death year of the person followed the birth year. It is evident from the percentage plot as well which shows that death year is missing in almost 90% of the data while the birth year is missing in approximately 80% of the data.<br/>
3. Apart from the death year and birth year variables, the column that has missing values in the 'name' dataset is knownForTitles. This implies that for some celebrities it is known that for what titles they are most known for. The knownForTitles variable is missing in ~15% of the rows.<br/>
4. It is interpreted from the right side bar plot the proportion of rows having complete values is very less that is approximately 1%.<br/>
5. There are more number of rows that has missing values for both, that is, death year as well as birth year compared to having missing values for individual columns. Moreover, the percentage of rows that has only death year or birth year as missing values is also less than the percentage of rows that has death year, birth year, and knownForTitles together missing.<br/>
6. Interestingly, there are very less percentage of rows that has only knownForTitle as the missing values, that is, almost < 1%. This column is always seen missing in a significant proportion with death year and birth year both. At cases where knownForTitles is missing with either death year or birth year, its percentage is also observed to be < 1%.<br/>

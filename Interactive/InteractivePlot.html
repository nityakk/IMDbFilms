<!DOCTYPE html>
<html lang="en">

  <head>
		<meta charset="utf-8">
		<title>Interactive Plot</title>
		<script src="https://d3js.org/d3.v6.js"></script>
	</head>
  
  <select id="selectButton"></select>
	<div id="my_dataviz"></div>

  <script>
  
    var w = 800;
		var h = 800;
		var padding = 40;

		//Create scale functions
		var xScale = d3.scaleLinear()
		.domain([0, 1])
		.range([padding, w - padding / 2]);

		var yScale = d3.scaleLinear()
		.domain([0, 1])
		.range([h - padding, padding / 2]);

		// define X axis
		var xAxis = d3.axisBottom()
		.scale(xScale)
		.ticks(5);

		//Define Y axis
		var yAxis = d3.axisLeft()
		.scale(yScale)
		.ticks(5);
      
		var svg = d3.select("#my_dataviz")
		  .append("svg")
		  .attr("width", w)
		  .attr("height", h);
		  
		//Create X axis
		svg.append("g")
		.attr("id", "xaxis")
		.attr("transform", "translate(0," + (h - padding) + ")")
		.call(xAxis);
		
				//Create Y axis
		svg.append("g")
		.attr("id", "yaxis")
		.attr("transform", "translate(" + padding + ",0)")
		.call(yAxis);
		
		
		d3.csv("https://raw.githubusercontent.com/nityakk/IMDbFilms/main/sources_short/directorRatings.csv").then(function(data) {
      xScale.domain([d3.min(data.map(d => d.startYear)),
        d3.max(data.map(d => d.startYear))]);
        
      yScale.domain([d3.min(data.map(d => d.averageRating)),
        d3.max(data.map(d => d.averageRating))]);
        
      d3.select("#xaxis").call(xAxis);
      d3.select("#yaxis").call(yAxis);
        
      let directorOptions = [...new Set(data.map(d => d.primaryName))]; 
      
      // add the options to the button
      d3.select("#selectButton")
        .selectAll('myOptions')
       	.data(directorOptions)
        .enter()
      	.append('option')
        .text(function (d) { return d; }) // text showed in the menu
        .attr("chosen", function (d) { return d; }) // corresponding value returned by the button
		
  		// add the options to the button
      var dropdown = d3.select("#selectButton")
        .selectAll('myOptions')
       	.data(directorOptions)
        .enter()
      	.append('option')
        .text(function (d) { return d; }) // text showed in the menu
        .attr("chosen", function (d) { return d; }) // corresponding value returned by the button
		});
		
		function update(director) {
		  directorSet = "https://raw.githubusercontent.com/nityakk/IMDbFilms/main/sources_short/" + director + "_Ratings.csv"
		  d3.csv(directorSet).then(function(data) {
        
        
        d3.select("svg")
          .selectAll("circle")
          .data(data)
          .enter()
          .append("circle")
          .attr("cx", d => xScale(d.startYear))
          .attr("cy", d => yScale(d.averageRating))
          .attr("r", "3")
          .attr("fill", "blue");
        
        })
        .catch(function(error) {
          d3.select("body")
            .append("h2")
            .text("I can't find the data!!! :-(")
        });
		}
		
		dropdown.on('change', function() {
      console.log(this.value);
      update(this.value);
    })
		
		
		
  </script>
</html>
